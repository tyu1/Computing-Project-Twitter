<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">


    <title>Political Tweets Analysis</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/person-profile.css" rel="stylesheet">
    <script src="js/jquery.min.js"></script>



</head>

<body>
<div class="container-fluid">
    <div class="row">
        
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
              <h1 id = 'titile'> </h1>

                <script src="http://d3js.org/d3.v3.min.js"></script>
                <script src="js/report.js"></script>
                <script>
                    var diameter = 900,
                            format = d3.format(",d"),
                            color = d3.scale.category20c();

                    var bubble = d3.layout.pack()
                            .sort(null)
                            .size([diameter, diameter])
                            .padding(1.5);

                    var svg = d3.select("body").append("svg")
                            .attr("width", diameter)
                            .attr("height", diameter)
                            .attr("class", "bubble");
                    var QueryString = function () {
                        // This function is anonymous, is executed immediately and
                        // the return value is assigned to QueryString!
                        var query_string = {};
                        var query = window.location.search.substring(1);
                        var vars = query.split("&");
                        for (var i=0;i<vars.length;i++) {
                            var pair = vars[i].split("=");
                            // If first entry with this name
                            if (typeof query_string[pair[0]] === "undefined") {
                                query_string[pair[0]] = pair[1];
                                // If second entry with this name
                            } else if (typeof query_string[pair[0]] === "string") {
                                var arr = [ query_string[pair[0]], pair[1] ];
                                query_string[pair[0]] = arr;
                                // If third or later entry with this name
                            } else {
                                query_string[pair[0]].push(pair[1]);
                            }
                        }
                        return query_string;
                    } ();

                    document.getElementById('titile').innerHTML = decodeURI(QueryString.name) + " frequent hashtags:";

                    jQuery.ajax({
                        type: "GET",
                        url: "/hashtagsByName?screen_name=" + QueryString.screen_name,
                        cache: false,
                        success: function(root){
                            console.log(root);
                            if(root.length == 0) {
                                return;
                            }
                            var node = svg.selectAll(".node")
                                    .data(bubble.nodes(classes(root))
                                            .filter(function(d) { return !d.children; }))
                                    .enter().append("g")
                                    .attr("class", "node")
                                    .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

                            node.append("title")
                                    .text(function(d) { return d.className + ": " + format(d.value); });

                            node.append("circle")
                                    .attr("r", function(d) { return d.r; })
                                    .style("fill", function(d) { return color(d.packageName); });

                            node.append("text")
                                    .attr("dy", ".3em")
                                    .style("text-anchor", "middle")
                                    .text(function(d) { return d.className.substring(0, d.r / 3); });
                        }
                    });

                    function classes(root) {
                        var classes = [];

                        function recurse(name, node) {
                            if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
                            else classes.push({packageName: name, className: node.name, value: node.size});
                        }

                        recurse(null, root);
                        return {children: classes};
                    }

                    d3.select(self.frameElement).style("height", diameter + "px");

                </script>

            </div>


        </div>
    </div>
</div>


</body>
</html>
